# Railway service configuration for Phase 2.2 Queue Worker + Webhook

[build]
builder = "NIXPACKS"
buildCommand = "pip install -r requirements.txt"

[deploy]
# Start unified service: FastAPI (foreground) + Queue Worker (background task)
# Railway detects the HTTP server and exposes public URL
startCommand = "uvicorn src.main:app --host 0.0.0.0 --port $PORT"

# Restart if either process crashes
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[environment]
REDIS_URL = "{{ .REDIS_URL }}"
CLOUDFLARE_ROUTER_URL = "{{ .CLOUDFLARE_ROUTER_URL }}"
