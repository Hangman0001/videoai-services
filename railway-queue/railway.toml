# Railway service configuration for Phase 2.2 Queue Worker + Webhook

[build]
builder = "NIXPACKS"
buildCommand = "pip install -r requirements.txt"

[deploy]
# Start FastAPI webhook AND queue worker together
startCommand = "uvicorn src.webhook:app --host 0.0.0.0 --port $PORT & python src/worker.py"

# Restart if either process crashes
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[environment]
REDIS_URL = "{{ .REDIS_URL }}"
CLOUDFLARE_ROUTER_URL = "{{ .CLOUDFLARE_ROUTER_URL }}"
